การตั้งค่าเพื่อการส่งออกข้อมูล LABFU ในระบบฐานข้อมูล Hosxp ปีงบประมาณ 2562
เครือข่ายโรงพยาบาลนครปฐม
Update Version 2018-12-11

------

ที่มาของปัญหา

​	โครงสร้างมาตรฐานข้อมูลด้านการแพทย์และสุขภาพ กระทรวงสาธารณสุข หรือ โครงสร้างมาตรฐานข้อมูล 43 แฟ้ม ตั้งแต่ปีงบประมาณ 2560 เป็นต้นมา  มีการปรับเปลี่ยนที่สำคัญคือ มีการเพิ่มรหัสมาตรฐาน ในแฟ้ม  LABFU เพื่อให้รองกับจำนวน ผลตรวจทางห้องปฏิบัติการให้มากขึ้น จากเดิม ที่มีอยู่ 21 รายการ และเกี่ยวข้องกับแฟ้ม CHRONIC หรือ แฟ้มทะเบียนผู้ป่วยโรคเรื้งรังเท่านั้น ให้เพิ่มมากขึ้น เพื่อให้รองรับกับการรายงานผล ร่วมกับ กิจกรรมด้านอื่นๆด้วย เช่น ผลตรวจ VDRL ในกลุ่มหญิงตั้งครรภ์ หรือ ผลตรวจการตรวจหาค่าฮีมาโตคริตในเลือด  ในกลุ่มเด็กเล็ก หรือ เด็กวัยเรียนเพื่อหาความเสี่ยงต่อภาวะซีดเป็นต้น

​	โดย ปัจจุบันนี้ ใช้ โครงสร้างมาตรฐานข้อมูล 43 แฟ้ม version 2.3   ปีงบประมาณ 2561 ณ วันที่ 6 ธันวาคม 2560 มีรหัสรายการ ทั้งหมด 1,433 รายการ และรหัสที่ใช้เป็นรหัส 7 หลัก จากเดิมที่ใช้เพียง 2 หลัก  เพื่อรองรับกับรายการที่มากขึ้นด้วย

​	แต่ปัญหาที่เกิดขึ้นก็คือ โปรแกรมที่ใช้สำหรับการบันทึกข้อมูลเพื่อให้ส่งออกข้อมูลนั้น มีการปรับโครงสร้างระบบฐานข้อมูลแล้ว แต่ หน่วยบริการ ยังไม่ทราบว่าเงื่อนไข อะไรทีทำให้ผลการบันทึกข้อมูล ถูกส่งออกได้อย่างถูกต้อง ครบถ้วน ตามรูปแบบมาตรฐาน หรือ โปรแกรมที่ใช้จะเป็นรุ่นใด การจับคู่รายการ LAB หรือ ระบุ รหัส 7 หลัก ผ่านโปรแกรมใด จึงได้จัดทำคำอธิบาย ขั้นตอน และตัวอย่างนี้ ไว้เพื่อหน่วยบริการ  สามารถเข้าไปจัดการตั้งค่า และ บันทึกผลได้เบื้องต้น

​	โดยได้ทำการติดต่อทาง Email ไปยัง BMS ผู้พัฒนาโปรแกรม และ ระบบฐานข้อมูลที่หน่วยบริการ เพื่อขอรับคำแนะนำแนวทางแก้ไขเบื้องต้น ซึ่งได้รับคำแนะนำมาดังนี้



> แนะนำให้ทำการ map รหัสมาตรฐาน 7 หลัก ที่ตาราง lab_items ฟิลด์ provis_labcode ให้ได้ 21 รายการขึ้นไป
> เมื่อใช้งานโปรแกรมส่งออก 43 แฟ้ม จะไม่แจ้งเตือนเรื่องการ map รหัส lab อีก 
> และโปรแกรมจะทำการดึงผล LAB ทุกตัวจากตาราง lab_order มาส่งออกแทนตาราง opdscreen



​	จากคำแนะนำดังกล่าวจึงได้ทดลอง ทำตามวิธีและมีผลลัพพธ์ได้ถูกต้อง  จึงสรุปได้ดังนี้



หากทำการ ใส่รหัส 7 หลัก มากกว่า หรือ เท่ากับ 21 รายการขึ้นไป
- ผลแลป จะไปดึงมาจาก lab_order.lab_order_result เป็น LABFU.LABRESULT
- รหัส 7 หลัก จะไปดึงมาจาก lab_items.provis_labcode เป็น LABFU.LABTEST

หากทำการ ใส่รหัส 7 หลัก น้อยกว่า 21 รายการขึ้นไป
- จะมีหน้าต่างเตือน ตอนที่จะประมวลผล ส่งออก  43 แฟ้ม
- ผลแลป และ รหัส จะไปดึงผลมาจากตาราง opdscreen ทีมีการ + จับคู่รายการแลป และ มีการ + Update ผล Lab เรียบร้อย แล้วเท่านั้น

​	เมื่อพิจารณาจากข้อสรุปแล้ว หากต้องการแก้ไขที่ง่ายที่สุด  ก็แค่เพียงระบุ รหัส 7 หลัก ให้มากกว่า  21 รายการขึ้นไป ผลแลป และ รหัสแลป ก็จะถูกส่งออกได้อย่างถูกต้อง โดยที่ไม่จำเป็นต้อง ทำการจับคู่รายการแลปที่เหลือ  และทำการ Update Lab อื่นๆ

​	แต่ วิธีการข้างต้นนั้น อาจจะทำให้ ผลแลปบางตัว ไม่ถูกส่งออกเช่น ผล DTX ก่อนอาหาร หรือ หลังอาหาร ที่หน้าฟอร์ม One Stop Service จะแปลผล ดังนี้

| รหัส 2 หลัก | รหัส 7 หลัก | รายละเอียด                                       |
| --------- | --------- | ----------------------------------------------- |
| 03        | 0531101   | 03=ตรวจน้ำตาลในเลือด   จากเส้นเลือดฝอย หลังอดอาหาร   |
| 04        | 0531102   | 04=ตรวจน้ำตาลในเลือด   จากเส้นเลือดฝอย โดยไม่อดอาหาร |

หรือ ผลแลปที่เกี่ยวข้องกับ ฟอร์มคลินิกพิเศษโรคเรื้อรัง เพื่อดูกราฟ การเปลี่ยนแปลง อาจะไม่สามารถดูการเปลี่ยนแปลงได้เช่น

| รหัส 2 หลัก | รหัส 7 หลัก | รายละเอียด                                                    |
| --------- | --------- | ------------------------------------------------------------ |
| 01        | 0531002   | 01=ตรวจน้ำตาลในเลือด   จากหลอดเลือดดำ หลังอดอาหาร                |
| 02        | 0531004   | 02=ตรวจน้ำตาลในเลือด   จากหลอดเลือดดำ โดยไม่อดอาหาร              |
| 05        | 0531601   | 05=ตรวจ   HbA1C                                              |
| 06        | 0546602   | 06=ตรวจ   Triglyceride                                       |
| 07        | 0541602   | 07=ตรวจ   Total Cholesterol                                  |
| 08        | 0541202   | 08=ตรวจ   HDL Cholesterol                                    |
| 09        | 0541402   | 09=ตรวจ   LDL Cholesterol                                    |
| 10        | 0583001   | 10=ตรวจ   BUN ในเลือด                                         |
| 11        | 0581902   | 11=ตรวจ   Creatinine ในเลือด                                  |
| 12        | 0440204   | 12=ตรวจโปรตีน   microalbumin ในปัสสาวะ (ใน filed ผลการตรวจใส่ค่า 0=negative, 1=trace,   2=positive) |

เพราะระบบจะดึงผลมาใส่จากชื่อที่มีการจับคู่เท่านั้น ไม่ได้ดึงมาจาก รหัสมาตรฐาน 7 หลัก ที่ระบุเข้าไป หรือ แม้กระทั้ง การคำนวนค่า egfr นั้นที่ระบบทำการคำนวนอัตโนมัติ และ ส่งออกมาให้ ก็ได้มาจากปัจจัย ค่า Creatinine + เพศ + อายุ

| เพศ  | ระดับ Creatinine ในเลือด (mg/dL) | สมการ                                     |
| ---- | ------------------------------ | ----------------------------------------- |
| หญิง  | น้อยกว่า หรือ เท่ากับ 0.7           | eGFR = 144 x (SCr/0.7)-0.329 X (0.993)Age |
| หญิง  | มากกว่า 0.7                     | eGFR = 144 x (SCr/0.7)-1.209 X (0.993)Age |
| ชาย  | น้อยกว่า หรือ เท่ากับ 0.9           | eGFR = 141 x (SCr/0.9)-0.411 X (0.993)Age |
| ชาย  | มากกว่า 0.9                     | eGFR = 141 x (SCr/0.9)-1.209 X (0.993)Age |

ซึ่งค่า eGFR ระบบ จะไม่แสดงผล แต่ มีการส่งออกเมื่อการประมวล 43 แฟ้ม โดยใช้สูตรการคำนวน ของสมาคมโรคไต ปี 2558	



> ​	เพราะฉะนั้น เพื่อความสมบรูณ์ของข้อมูล และ การใช้งาน จึงจำเป็น ต้องมีการระบุ รหัส 7 หลัก ให้มากกว่า 21 รายการ ร่วมกับ จับคู่รายการ Lab และ ทำการ Update Lab ก่อนการประมวผลส่งออกข้อมูล
>
> ​	การจับคู่รายการ Lab ทำเพียงครั้งเดียว เหมือนการตั้งค่าใช้งานทั่วไป ไม่จำเป็นต้องทำหลายครั้ง แต่การ Update Lab ควรทำก่อนการประมวลผลทุกครั้ง เพื่อความครบถ้วน ถูกต้อง และ สมบูรณ์



------

เริ่มต้น ขั้นตอนการแก้ไข

1. ติดตั้งโปรแกรมที่เกี่ยวข้องให้ครบถ้วน
  1.1 BMSHOSxPXE4CloudApplicationInstaller.exe
  1.2 HOSxPXE PCU(สีฟ้า)
  1.3 BMSHOSxPStandard43Export(สีขาว)
2. เปิดระบบ emergency mode และ ห้องตรวจ ผ่านเมนู SQL ด้วยโปรแกรม HOSxP PCU(สีเขียว)
 3. ปรับปรุงโครงสร้างฐานข้อมูล ด้วยโปรแกรม BMSHOSxPStandard43Export(สีขาว)
4. จับคู่รายการ LAB ในระบบ และ การ Update ผล LAB  ด้วยโปรแกรม HOSxP PCU(สีเขียว)
5. ระบุ รหัสมาตรฐาน  7 หลักในระบบ ด้วยโปรแกรม HOSxPXE PCU(สีฟ้า)
6. ประมวลผล และ ส่งออกข้อมูล ด้วยโปรแกรม BMSHOSxPStandard43Export(สีขาว)